package com.tjoeun.controller;

import java.util.List;
import java.util.Map;
import java.util.Set;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.MatrixVariable;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import com.tjoeun.domain.Book;
import com.tjoeun.service.BookService;

@Controller
@RequestMapping("/books")
public class BookController {
  @Autowired
  private BookService bookService;
  
  @GetMapping
  public String books(Model model) {
  	List<Book> bookList = bookService.getAllBookList();
  	// System.out.println(bookList.size());
  	model.addAttribute("bookList", bookList);
  	return "books";
  }
  
  @GetMapping("/all")
  public ModelAndView requestAllBooks() {
  	ModelAndView mv = new ModelAndView();
  	List<Book> bookList = bookService.getAllBookList();
  	mv.addObject("bookList", bookList);
  	mv.setViewName("books");
  	return mv;  	
  }
  
  @GetMapping("/{category}")
  public String requestBooksByCategory(@PathVariable("category") String category,
  		                                 Model model) {
  	List<Book> booksByCategory = bookService.getBookListByCategory(category);
  	model.addAttribute("bookList", booksByCategory);
  	return "books";
  }
  
  @GetMapping("/filter/{bookFilter}")
  // Map<String, List<String>> : 출판사별 책이름을 지정한 HashMap
  public String requestBooksByFilter(
  		@MatrixVariable(pathVar="bookFilter") Map<String, List<String>> bookFilter,
  		Model model) {
  	
  	Set<Book> booksByFilter = bookService.getBookListByFilter(bookFilter);
  	
  	model.addAttribute("bookList", booksByFilter);
  	
  	return "books";
  }
  
  
  // @RequestParam 을 사용해서 도서 ID 로 도서 검색하기
  // bookService의 getBookById(String bookId) 메소드 호출하기
  @GetMapping("/book")
  public String requestBookById(@RequestParam String bookId, Model model) {
  	
  	Book bookById = bookService.getBookById(bookId);
  	model.addAttribute("bookById", bookById);
  	return "book";
  }
  
  // 도서 등록
  @GetMapping("/regBook")
  public String regBook(@ModelAttribute("")Book book) {
  	return "regBook";
  }
}



